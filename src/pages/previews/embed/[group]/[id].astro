---
import FooterAssets from '../../../../components/FooterAssets.astro';
// PageHead previously injected a <base> and analytics scripts which break local embeds.
// Instead we include only the necessary stylesheet links for header rendering (no <base>, no analytics).

// New home sections with local assets
import HomeNavbar from '../../../../components/sections/home/HomeNavbar.astro';
import HomeHeroSlider from '../../../../components/sections/home/HomeHeroSlider.astro';
import HomeCertificationBadges from '../../../../components/sections/home/HomeCertificationBadges.astro';
import HomeAboutSection from '../../../../components/sections/home/HomeAboutSection.astro';
import HomeFeaturesGrid from '../../../../components/sections/home/HomeFeaturesGrid.astro';
import HomeStatisticsInfographic from '../../../../components/sections/home/HomeStatisticsInfographic.astro';
import HomeCampusSlider from '../../../../components/sections/home/HomeCampusSlider.astro';
import HomeProgramCards from '../../../../components/sections/home/HomeProgramCards.astro';
// Gioi thieu sections
import Navbar from '../../../../components/sections/about/Navbar.astro';
import GioiThieuSection from '../../../../components/sections/about/GioiThieuSection.astro';
import HeroSlider from '../../../../components/sections/about/HeroSlider.astro';
import IntroSection from '../../../../components/sections/about/IntroSection.astro';
import ProgramCardsSection from '../../../../components/sections/about/ProgramCardsSection.astro';
import InfographicSection from '../../../../components/sections/about/InfographicSection.astro';
import LifeEduSection from '../../../../components/sections/about/LifeEduSection.astro';
import ExtracurricularSection from '../../../../components/sections/about/ExtracurricularSection.astro';
import CampusListSection from '../../../../components/sections/about/CampusListSection.astro';
import ThanhTichAltSection from '../../../../components/sections/about/ThanhTichAltSection.astro';
import ThanhTichAltSectionEdit from '../../../../components/sections/about/ThanhTichAltSectionEdit.astro';
import ThanhTichGridSection from '../../../../components/sections/about/ThanhTichGridSection.astro';
import ThanhTichInfographicSection from '../../../../components/sections/about/ThanhTichInfographicSection.astro';
import AchievementsPremiumSection from '../../../../components/sections/about/AchievementsPremiumSection.astro';
// Clone sections
import SliderSection from '../../../../components/sections/clone/SliderSection.astro';
import FooterSection from '../../../../components/sections/clone/FooterSection.astro';
import ChuongTrinhSection from '../../../../components/sections/clone/ChuongTrinhSection.astro';
import ProgramsElement from '../../../../components/sections/clone/ProgramsElement.astro';
import EducationLifeElement from '../../../../components/sections/clone/EducationLifeElement.astro';

const { group, id } = Astro.params;

// Log on the server when an embed is requested to help diagnose rendering issues
console.log(`[embed] requested ${group}/${id}`);

// Components that require external dependencies and show placeholder instead of rendering
const scriptOnlyComponents = new Set([
  'FooterAssets', // Contains jQuery/WordPress scripts that fail in sandbox
]);

  // mapping object auto-generated from src/data/components.json
  import componentsData from '../../../../data/components.json';
  const components: Record<string, any> = { HomeNavbar, Navbar, HomeHeroSlider, HomeCertificationBadges, HomeAboutSection, HomeFeaturesGrid, HomeStatisticsInfographic, HomeCampusSlider, HomeProgramCards, HeroSlider, IntroSection, ProgramCardsSection, InfographicSection, LifeEduSection, ExtracurricularSection, CampusListSection, ThanhTichAltSection, ThanhTichAltSectionEdit, ThanhTichGridSection, ThanhTichInfographicSection, AchievementsPremiumSection, GioiThieuSection, SliderSection, ChuongTrinhSection, ProgramsElement, EducationLifeElement, FooterAssets, FooterSection };
  const mapping: Record<string, Record<string, any>> = {};
  for (const comp of componentsData.components) {
    if (!mapping[comp.group]) mapping[comp.group] = {};
    mapping[comp.group][comp.id] = components[comp.id];
  }

const Group = (mapping as any)[group as string] ?? {};
const Component = Group && (Group as any)[id as string] ? (Group as any)[id as string] : null;

export function getStaticPaths() {
  // getStaticPaths auto-generated from src/data/components.json
  const paths: Array<{ params: { group: string; id: string } }> = [];
  for (const comp of componentsData.components) {
    paths.push({ params: { group: comp.group, id: comp.id } });
  }
  return paths;
}
---

<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Embed Preview: {id}</title>
    <style>
      :root { color-scheme: light; }
      body { margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
  </head>
  <body>
    {scriptOnlyComponents.has(id as string) ? (
      <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100px; padding: 24px; background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%); color: #64748b; text-align: center;">
        <div style="font-size: 28px; margin-bottom: 8px;">ðŸ“¦</div>
        <div style="font-weight: 600; font-size: 14px;">{id}</div>
        <div style="font-size: 12px; opacity: 0.8;">Script/Asset Bundle</div>
        <div style="font-size: 11px; margin-top: 8px; opacity: 0.6;">External dependencies required</div>
      </div>
    ) : Component ? (
      <Component />
    ) : (
      <div style="padding:24px">Component not found: {group}/{id}</div>
    )}
  </body>
</html>
